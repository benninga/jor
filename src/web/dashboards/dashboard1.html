<html>
  <head>
    <!--Load the AJAX API-->
    <script type="text/javascript" src="https://www.google.com/jsapi"></script>
    <script type="text/javascript">

      // Load the Visualization API and the piechart package.
      google.load('visualization', '1.0', {'packages':['controls']});

      // Set a callback to run when the Google Visualization API is loaded.
      google.setOnLoadCallback(loadQueryData);

      function loadQueryData()
      {
            var query = new google.visualization.Query('../datasource?queryId=3');
  
            // Apply query language statement.
            //query.setQuery('SELECT name, population');
            query.setQuery('SELECT week, signup_change');
            
            // Send the query with a callback function.
            query.send(drawVisualization);
      }

      function drawVisualization(response)
      {
            if (response.isError())
            {
              alert('Error in query: ' + response.getMessage() + ' ' + response.getDetailedMessage());
              return;
            }
  
            var data = response.getDataTable();
            var dashboard = new google.visualization.Dashboard(document.getElementById('dashboard_div'));
            
            // Add range filter
            var donutRangeSlider = new google.visualization.ControlWrapper({
                'controlType': 'CategoryFilter',
                'containerId': 'filter_div',
                'options':
                  {
                    'filterColumnLabel': 'Event Name',
                    'ui' : 
                        {
                  	     'allowtyping' : false,
                  	     'allowMultiple': true,
                         'selectedValuesLayout': 'belowStacked'
                        }
                  },
                'state' : { 'selectedValues' : [ 'project_opened',
                                                 'contentfile_downloaded',
                                                 'unknown',
                                                 'project_created',
                                                 'contentfile_added',
                                                 'contentfile_deleted',
                                                 'viewer_opened',
                                                 'comment_added',
                                                 'contentfile_comment_added',
                                                 'pin_comment_added',
                                                 'project_owner_added',
                                                 'collaborator_added',
                                                 'limited_collaborator_added',
                                                 'project_owner_deleted',
                                                 'collaborator_deleted',
                                                 'limited_collaborator_deleted',
                                                 'badge_granted']
                        }
              });

            // Create a pie chart, passing some options
            var pieChart = new google.visualization.ChartWrapper({
              'chartType': 'PieChart',
              'containerId': 'chart_div',
              'options': {
                'title' : 'Activity Type Distribution',
                'width': 1100,
                'height': 700,
                'pieSliceText': 'label'
              }
            });
         
            // 'pieChart' will update whenever you interact with 'donutRangeSlider'
            // to match the selected range.
            dashboard.bind(donutRangeSlider, pieChart);
            
            dashboard.draw(data);
      }
      
    </script>
  </head>

  <body>
    <!--Div that will hold the pie chart-->
    <div id="dashboard_div" style="width: 1150px">
      <div id="filter_div"  style="width: 250px; float: left;"></div>
      <div id="chart_div"   style="width: 900px; float: right"></div>
    </div>
  </body>
</html>
