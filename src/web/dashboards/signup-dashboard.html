<html>
  <head>
    <!--Load the AJAX API-->
    <script type="text/javascript" src="https://www.google.com/jsapi"></script>
    <script type="text/javascript">

      // Load the Visualization API and the piechart package.
      google.load('visualization', '1.0', {'packages':['controls']});

      // Set a callback to run when the Google Visualization API is loaded.
      google.setOnLoadCallback(loadQueryData);

      var data;
      var signupChart;
      var dashboard;
      
      function loadQueryData()
      {
            var query = new google.visualization.Query('../datasource?queryId=2');
  
            // Send the query with a callback function.
            query.send(drawVisualization);
      }

      function drawVisualization(response)
      {
            if (response.isError())
            {
              alert('Error in query: ' + response.getMessage() + ' ' + response.getDetailedMessage());
              return;
            }
  
            data = response.getDataTable();
            dashboard = new google.visualization.Dashboard(document.getElementById('dashboard_div'));
            
            // Define a slider control for the week column.
            var slider = new google.visualization.ControlWrapper({
              'controlType': 'NumberRangeFilter',
              'containerId': 'filter_div',
              'options': {
                'filterColumnIndex': 0,
              'ui': {'labelStacking': 'vertical'}
              }
            });
            
            // Format percent change with a nice little bar
            var formatter = new google.visualization.BarFormat({width: 120});
            formatter.format(data, 4); // Apply formatter to second column

            // Create a column chart, passing some options
            signupChart = new google.visualization.ChartWrapper({
              'chartType': 'ColumnChart',
              'containerId': 'chart_div',
              'options': {
                'title' : 'User signup as Percent of Total of Previous Week- last 140 days - reported weekly',
                'width' : 1100,
                'height' : 700,
                'legend': 'bottom'
              },
              'view': {'columns': [0, 3]}
            });
         
            // Create a column chart, passing some options
            var signupTable = new google.visualization.ChartWrapper({
              'chartType': 'Table',
              'containerId': 'table_div',
              'options': {
                'title' : 'User signup - last 140 days - reported weekly',
                'legend': 'bottom',
                'allowHtml': true
              }
            });
         
            // Bind the slider and the charts and draw the data
            dashboard.bind(slider, signupChart).bind(slider, signupTable);
            dashboard.draw(data);
      }
      
    </script>
  </head>

  <body>
    <!--Div that will hold the pie chart-->
    <div id="dashboard_div" style="width: 1150px">
      <div id="controls_div" style="width: 250px; float:left;">
        <div id="filter_div"></div>
        
        <button onclick="alert('Coming Soon');">Show Weekly Percentage</button>
        <button onclick="alert('Coming Soon');">Show Weekly Percentage Change</button>
        
      </div>
      <div id="main_content_div" style="width: 900px; float: right;">
        <div id="chart_div" ></div>
        <div id="table_div"></div>
      </div>
    </div>
  </body>
</html>
